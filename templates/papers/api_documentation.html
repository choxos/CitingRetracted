{% extends 'base.html' %}
{% load static %}

{% block title %}{{ page_title }}{% endblock %}

{% block meta_description %}{{ page_description }}{% endblock %}

{% block extra_css %}
<style>
/* ===============================================
   API DOCUMENTATION PAGE STYLES
   =============================================== */

.hero-api {
    background: linear-gradient(135deg, #059669 0%, #047857 50%, #065f46 100%);
    color: white;
    padding: 4rem 0;
    position: relative;
    overflow: hidden;
}

.hero-api::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><defs><pattern id="api-pattern" x="0" y="0" width="20" height="20" patternUnits="userSpaceOnUse"><circle cx="10" cy="10" r="1" fill="rgba(255,255,255,0.1)"/></pattern></defs><rect width="100" height="100" fill="url(%23api-pattern)"/></svg>');
    opacity: 0.3;
}

.hero-api .container {
    position: relative;
    z-index: 1;
}

.api-overview-section {
    background: white;
    border-radius: 20px;
    padding: 2rem;
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
    margin-bottom: 2rem;
    transition: transform 0.3s ease, box-shadow 0.3s ease;
}

.api-overview-section:hover {
    transform: translateY(-5px);
    box-shadow: 0 15px 40px rgba(0, 0, 0, 0.15);
}

.endpoint-section {
    background: white;
    border-radius: 15px;
    padding: 2rem;
    margin-bottom: 2rem;
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
    transition: all 0.3s ease;
    border-left: 5px solid #059669;
}

.endpoint-section:hover {
    transform: translateY(-3px);
    box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
}

.endpoint-section h3 {
    color: #047857;
    margin-bottom: 1rem;
    font-weight: 600;
}

.endpoint-card {
    background: #f8fafc;
    border-radius: 10px;
    padding: 1.5rem;
    margin-bottom: 1.5rem;
    border: 1px solid #e2e8f0;
    transition: all 0.3s ease;
}

.endpoint-card:hover {
    background: #f1f5f9;
    border-color: #cbd5e1;
}

.endpoint-header {
    display: flex;
    align-items: center;
    margin-bottom: 1rem;
}

.method-badge {
    padding: 0.25rem 0.75rem;
    border-radius: 15px;
    font-size: 0.875rem;
    font-weight: 600;
    margin-right: 1rem;
}

.method-get {
    background: #10b981;
    color: white;
}

.method-post {
    background: #3b82f6;
    color: white;
}

.endpoint-path {
    font-family: 'Courier New', monospace;
    background: #1f2937;
    color: #10b981;
    padding: 0.5rem 1rem;
    border-radius: 8px;
    font-size: 0.9rem;
    margin: 0.5rem 0;
    overflow-x: auto;
}

.params-table {
    width: 100%;
    border-collapse: collapse;
    margin: 1rem 0;
    background: white;
    border-radius: 8px;
    overflow: hidden;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
}

.params-table th {
    background: #f3f4f6;
    padding: 0.75rem;
    text-align: left;
    font-weight: 600;
    color: #374151;
    border-bottom: 1px solid #e5e7eb;
}

.params-table td {
    padding: 0.75rem;
    border-bottom: 1px solid #f3f4f6;
}

.param-required {
    color: #dc2626;
    font-weight: 600;
}

.param-optional {
    color: #6b7280;
}

.code-section {
    background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%);
    border-radius: 15px;
    padding: 2rem;
    border: 1px solid #bae6fd;
    margin-bottom: 2rem;
}

.code-tabs {
    display: flex;
    margin-bottom: 1rem;
    border-bottom: 2px solid #e2e8f0;
}

.code-tab {
    padding: 0.75rem 1.5rem;
    background: none;
    border: none;
    cursor: pointer;
    font-weight: 500;
    color: #6b7280;
    transition: all 0.3s ease;
    border-bottom: 2px solid transparent;
}

.code-tab.active {
    color: #0284c7;
    border-bottom-color: #0284c7;
}

.code-tab:hover {
    color: #0284c7;
}

.code-content {
    display: none;
}

.code-content.active {
    display: block;
}

.code-block {
    background: #1f2937;
    color: #e5e7eb;
    padding: 1.5rem;
    border-radius: 8px;
    overflow-x: auto;
    font-family: 'Courier New', monospace;
    font-size: 0.9rem;
    line-height: 1.5;
    box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.1);
}

.rate-limit-card {
    background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);
    border: 1px solid #f59e0b;
    border-radius: 10px;
    padding: 1.5rem;
    margin: 1.5rem 0;
}

.feature-list {
    list-style: none;
    padding-left: 0;
    margin: 1rem 0;
}

.feature-list li {
    padding: 0.5rem 0;
    padding-left: 1.5rem;
    position: relative;
}

.feature-list li::before {
    content: 'âœ“';
    color: #10b981;
    font-weight: bold;
    position: absolute;
    left: 0;
}

.section-header {
    border-bottom: 3px solid #059669;
    padding-bottom: 0.5rem;
    margin-bottom: 2rem;
    position: relative;
}

.section-header::after {
    content: '';
    position: absolute;
    bottom: -3px;
    left: 0;
    width: 60px;
    height: 3px;
    background: linear-gradient(135deg, #059669 0%, #047857 100%);
    border-radius: 2px;
}

.copy-button {
    position: absolute;
    top: 10px;
    right: 10px;
    background: #374151;
    color: #e5e7eb;
    border: none;
    border-radius: 4px;
    padding: 0.25rem 0.5rem;
    font-size: 0.75rem;
    cursor: pointer;
    transition: all 0.3s ease;
}

.copy-button:hover {
    background: #4b5563;
}

.copy-button.copied {
    background: #10b981;
    color: white;
}

.api-stats {
    display: flex;
    justify-content: space-around;
    margin: 2rem 0;
    flex-wrap: wrap;
    gap: 1rem;
}

.stat-item {
    text-align: center;
    padding: 1rem;
    background: white;
    border-radius: 10px;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
    flex: 1;
    min-width: 150px;
}

.stat-number {
    font-size: 2rem;
    font-weight: bold;
    color: #059669;
}

.stat-label {
    font-size: 0.9rem;
    color: #6b7280;
    margin-top: 0.5rem;
}

@media (max-width: 768px) {
    .hero-api {
        padding: 2rem 0;
    }
    
    .api-overview-section, .endpoint-section, .code-section {
        padding: 1.5rem;
    }
    
    .endpoint-header {
        flex-direction: column;
        align-items: flex-start;
    }
    
    .method-badge {
        margin-bottom: 0.5rem;
    }
    
    .code-tabs {
        flex-wrap: wrap;
    }
    
    .api-stats {
        flex-direction: column;
    }
}
</style>
{% endblock %}

{% block content %}
<!-- Hero Section -->
<section class="hero-api">
    <div class="container">
        <div class="row">
            <div class="col-lg-8 mx-auto text-center">
                <h1 class="display-4 fw-bold mb-4">
                    <i class="fas fa-code me-3"></i>
                    API Documentation
                </h1>
                <p class="lead mb-4">
                    Complete REST API reference for the Post-Retraction Citation Tracker (PRCT).
                    Access retracted papers, citation data, analytics, and democracy analysis programmatically.
                </p>
                <div class="api-stats">
                    <div class="stat-item">
                        <div class="stat-number">{{ api_version }}</div>
                        <div class="stat-label">API Version</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-number">{{ endpoint_categories|length }}</div>
                        <div class="stat-label">Categories</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-number">15+</div>
                        <div class="stat-label">Endpoints</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- API Overview Section -->
<section class="py-5">
    <div class="container">
        <div class="row">
            <div class="col-lg-8 mx-auto">
                <div class="api-overview-section">
                    <h2 class="text-success fw-bold mb-3">
                        <i class="fas fa-info-circle me-2"></i>
                        API Overview
                    </h2>
                    <p class="lead mb-4">
                        The PRCT API provides programmatic access to our comprehensive database of retracted scientific papers, 
                        citation analysis, and research integrity tools. All endpoints return JSON responses and support various 
                        query parameters for filtering and customization.
                    </p>
                    
                    <h4 class="text-success mb-3">Key Features</h4>
                    <ul class="feature-list">
                        {% for feature in api_features %}
                        <li>{{ feature }}</li>
                        {% endfor %}
                    </ul>
                    
                    <div class="rate-limit-card">
                        <h5 class="text-amber-600 mb-3">
                            <i class="fas fa-tachometer-alt me-2"></i>
                            Rate Limits
                        </h5>
                        <ul class="mb-0">
                            <li><strong>General Endpoints:</strong> {{ rate_limits.general }}</li>
                            <li><strong>Export Endpoints:</strong> {{ rate_limits.export }}</li>
                            <li><strong>Analytics Endpoints:</strong> {{ rate_limits.analytics }}</li>
                        </ul>
                    </div>
                    
                    <div class="mt-4">
                        <p class="mb-2"><strong>Base URL:</strong> <code>{{ base_url }}</code></p>
                        <p class="mb-2"><strong>Authentication:</strong> Currently public (no API key required)</p>
                        <p class="mb-0"><strong>Response Format:</strong> JSON</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- API Endpoints Section -->
<section class="py-5 bg-light">
    <div class="container">
        <h2 class="section-header">
            <i class="fas fa-plug text-success me-2"></i>API Endpoints
        </h2>
        
        {% for category in endpoint_categories %}
        <div class="endpoint-section">
            <h3>
                <i class="fas fa-folder me-2"></i>
                {{ category.name }}
            </h3>
            <p class="text-muted mb-3">{{ category.description }}</p>
            
            {% for endpoint in category.endpoints %}
            <div class="endpoint-card">
                <div class="endpoint-header">
                    <span class="method-badge method-{{ endpoint.method|lower }}">{{ endpoint.method }}</span>
                    <h5 class="mb-0">{{ endpoint.name }}</h5>
                </div>
                
                <p class="text-muted mb-2">{{ endpoint.description }}</p>
                
                <div class="endpoint-path">{{ endpoint.path }}</div>
                
                {% if endpoint.params %}
                <h6 class="mt-3 mb-2">Parameters</h6>
                <table class="params-table">
                    <thead>
                        <tr>
                            <th>Parameter</th>
                            <th>Type</th>
                            <th>Required</th>
                            <th>Description</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for param in endpoint.params %}
                        <tr>
                            <td><code>{{ param.name }}</code></td>
                            <td><code>{{ param.type }}</code></td>
                            <td class="{% if param.required %}param-required{% else %}param-optional{% endif %}">
                                {% if param.required %}Required{% else %}Optional{% endif %}
                            </td>
                            <td>{{ param.description }}</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
                {% endif %}
                
                <div class="mt-3">
                    <strong>Example Request:</strong>
                    <div class="endpoint-path">
                        GET {{ base_url }}{{ endpoint.path }}{% if endpoint.params and not endpoint.params.0.required %}?{% for param in endpoint.params %}{% if not param.required %}{{ param.name }}=example{% if not forloop.last %}&{% endif %}{% endif %}{% endfor %}{% endif %}
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
        {% endfor %}
    </div>
</section>

<!-- Code Examples Section -->
<section class="py-5">
    <div class="container">
        <h2 class="section-header">
            <i class="fas fa-code text-success me-2"></i>Code Examples
        </h2>
        
        <div class="code-section">
            <div class="code-tabs">
                <button class="code-tab active" onclick="showCodeTab('javascript')">JavaScript</button>
                <button class="code-tab" onclick="showCodeTab('python')">Python</button>
                <button class="code-tab" onclick="showCodeTab('curl')">cURL</button>
                <button class="code-tab" onclick="showCodeTab('r')">R</button>
            </div>
            
            <div id="javascript-code" class="code-content active">
                <div style="position: relative;">
                    <pre class="code-block">{{ code_examples.javascript }}</pre>
                    <button class="copy-button" onclick="copyCode('javascript-code')">Copy</button>
                </div>
            </div>
            
            <div id="python-code" class="code-content">
                <div style="position: relative;">
                    <pre class="code-block">{{ code_examples.python }}</pre>
                    <button class="copy-button" onclick="copyCode('python-code')">Copy</button>
                </div>
            </div>
            
            <div id="curl-code" class="code-content">
                <div style="position: relative;">
                    <pre class="code-block">{{ code_examples.curl }}</pre>
                    <button class="copy-button" onclick="copyCode('curl-code')">Copy</button>
                </div>
            </div>
            
            <div id="r-code" class="code-content">
                <div style="position: relative;">
                    <pre class="code-block">{{ code_examples.r }}</pre>
                    <button class="copy-button" onclick="copyCode('r-code')">Copy</button>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- Support Section -->
<section class="py-5 bg-light">
    <div class="container">
        <div class="row">
            <div class="col-lg-8 mx-auto text-center">
                <div class="api-overview-section">
                    <h3 class="text-success mb-3">
                        <i class="fas fa-life-ring me-2"></i>Support & Contact
                    </h3>
                    <p class="mb-3">
                        Need help with the API? Have questions or feedback? We're here to help.
                    </p>
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <div class="h-100 p-3 bg-white rounded border">
                                <h6><i class="fas fa-book text-primary me-2"></i>Documentation</h6>
                                <p class="small mb-0">Complete API reference and guides available on this page</p>
                            </div>
                        </div>
                        <div class="col-md-6 mb-3">
                            <div class="h-100 p-3 bg-white rounded border">
                                <h6><i class="fas fa-envelope text-info me-2"></i>Email Support</h6>
                                <p class="small mb-0">Contact: ahmad.pub@gmail.com</p>
                            </div>
                        </div>
                    </div>
                    <div class="mt-3">
                        <small class="text-muted">
                            Last Updated: {{ last_updated }} | API Version: {{ api_version }}
                        </small>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Add smooth scrolling for internal links
    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener('click', function (e) {
            e.preventDefault();
            const target = document.querySelector(this.getAttribute('href'));
            if (target) {
                target.scrollIntoView({
                    behavior: 'smooth'
                });
            }
        });
    });
    
    // Add animation to cards on scroll
    const observerOptions = {
        threshold: 0.1,
        rootMargin: '0px 0px -50px 0px'
    };
    
    const observer = new IntersectionObserver(function(entries) {
        entries.forEach(entry => {
            if (entry.isIntersecting) {
                entry.target.style.opacity = '1';
                entry.target.style.transform = 'translateY(0)';
            }
        });
    }, observerOptions);
    
    // Observe all cards
    document.querySelectorAll('.endpoint-section, .endpoint-card, .api-overview-section').forEach(card => {
        card.style.opacity = '0';
        card.style.transform = 'translateY(20px)';
        card.style.transition = 'opacity 0.6s ease, transform 0.6s ease';
        observer.observe(card);
    });
});

// Code tab functionality
function showCodeTab(language) {
    // Hide all code contents
    document.querySelectorAll('.code-content').forEach(content => {
        content.classList.remove('active');
    });
    
    // Remove active class from all tabs
    document.querySelectorAll('.code-tab').forEach(tab => {
        tab.classList.remove('active');
    });
    
    // Show selected code content
    document.getElementById(language + '-code').classList.add('active');
    
    // Add active class to clicked tab
    event.target.classList.add('active');
}

// Copy code functionality
function copyCode(elementId) {
    const codeElement = document.querySelector('#' + elementId + ' .code-block');
    const text = codeElement.textContent;
    
    navigator.clipboard.writeText(text).then(function() {
        const button = document.querySelector('#' + elementId + ' .copy-button');
        const originalText = button.textContent;
        
        button.textContent = 'Copied!';
        button.classList.add('copied');
        
        setTimeout(function() {
            button.textContent = originalText;
            button.classList.remove('copied');
        }, 2000);
    }).catch(function() {
        // Fallback for older browsers
        const textArea = document.createElement('textarea');
        textArea.value = text;
        document.body.appendChild(textArea);
        textArea.select();
        document.execCommand('copy');
        document.body.removeChild(textArea);
        
        const button = document.querySelector('#' + elementId + ' .copy-button');
        button.textContent = 'Copied!';
        button.classList.add('copied');
        
        setTimeout(function() {
            button.textContent = 'Copy';
            button.classList.remove('copied');
        }, 2000);
    });
}

// Syntax highlighting for code blocks (simple approach)
document.addEventListener('DOMContentLoaded', function() {
    document.querySelectorAll('.code-block').forEach(block => {
        let html = block.innerHTML;
        
        // Simple syntax highlighting
        html = html.replace(/(async|function|const|let|var|import|from|class|def|if|else|for|while|try|except|catch)/g, '<span style="color: #f59e0b;">$1</span>');
        html = html.replace(/(GET|POST|PUT|DELETE)/g, '<span style="color: #10b981;">$1</span>');
        html = html.replace(/(".*?")/g, '<span style="color: #60a5fa;">$1</span>');
        html = html.replace(/(#.*$)/gm, '<span style="color: #6b7280;">$1</span>');
        
        block.innerHTML = html;
    });
});
</script>
{% endblock %}
