{% extends 'prct_base.html' %}
{% load static %}

{% block title %}{{ page_title }}{% endblock %}

{% block meta_description %}{{ page_description }}{% endblock %}

{% block extra_css %}
{{ block.super }}
<style>
/* ===============================================
   API DOCUMENTATION PAGE STYLES (PRCT THEME)
   =============================================== */

.prct-api-hero {
    background: var(--prct-gradient-primary);
    color: white;
    padding: 4rem 0;
    margin-bottom: 3rem;
    border-radius: 0 0 2rem 2rem;
}

.prct-api-hero-content {
    text-align: center;
}

.prct-api-hero-title {
    font-size: 3rem;
    font-weight: 700;
    margin-bottom: 1rem;
    text-shadow: 0 2px 4px rgba(0,0,0,0.1);
}

.prct-api-hero-subtitle {
    font-size: 1.25rem;
    margin-bottom: 2rem;
    opacity: 0.9;
}

.prct-api-stats {
    display: flex;
    justify-content: space-around;
    margin: 2rem 0;
    flex-wrap: wrap;
    gap: 1rem;
}

.prct-api-stat-item {
    text-align: center;
    padding: 1rem;
    background: rgba(255, 255, 255, 0.1);
    border-radius: 10px;
    backdrop-filter: blur(10px);
    flex: 1;
    min-width: 150px;
}

.prct-api-stat-number {
    font-size: 2rem;
    font-weight: bold;
    color: white;
}

.prct-api-stat-label {
    font-size: 0.9rem;
    color: rgba(255, 255, 255, 0.8);
    margin-top: 0.5rem;
}

.prct-api-section {
    background: white;
    border-radius: 1rem;
    padding: 2rem;
    box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1);
    margin-bottom: 2rem;
    border-left: 4px solid var(--xera-primary);
    transition: all 0.3s ease;
}

.prct-api-section:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 25px rgba(0,0,0,0.15);
}

.prct-endpoint-section {
    background: white;
    border-radius: 1rem;
    padding: 2rem;
    margin-bottom: 2rem;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    border-left: 4px solid var(--xera-primary);
    transition: all 0.3s ease;
}

.prct-endpoint-section:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 8px rgba(0,0,0,0.15);
}

.prct-endpoint-section h3 {
    color: var(--xera-primary);
    margin-bottom: 1rem;
    font-weight: 600;
}

.prct-endpoint-card {
    background: #f8fafc;
    border-radius: 10px;
    padding: 1.5rem;
    margin-bottom: 1.5rem;
    border: 1px solid #e2e8f0;
    transition: all 0.3s ease;
}

.prct-endpoint-card:hover {
    background: #f1f5f9;
    border-color: #cbd5e1;
}

.prct-endpoint-header {
    display: flex;
    align-items: center;
    margin-bottom: 1rem;
}

.prct-method-badge {
    padding: 0.25rem 0.75rem;
    border-radius: 15px;
    font-size: 0.875rem;
    font-weight: 600;
    margin-right: 1rem;
}

.prct-method-get {
    background: #10b981;
    color: white;
}

.prct-method-post {
    background: #3b82f6;
    color: white;
}

.prct-endpoint-path {
    font-family: 'Courier New', monospace;
    background: #1f2937;
    color: #10b981;
    padding: 0.5rem 1rem;
    border-radius: 8px;
    font-size: 0.9rem;
    margin: 0.5rem 0;
    overflow-x: auto;
}

.prct-params-table {
    width: 100%;
    border-collapse: collapse;
    margin: 1rem 0;
    background: white;
    border-radius: 8px;
    overflow: hidden;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
}

.prct-params-table th {
    background: #f3f4f6;
    padding: 0.75rem;
    text-align: left;
    font-weight: 600;
    color: #374151;
    border-bottom: 1px solid #e5e7eb;
}

.prct-params-table td {
    padding: 0.75rem;
    border-bottom: 1px solid #f3f4f6;
}

.prct-param-required {
    color: #dc2626;
    font-weight: 600;
}

.prct-param-optional {
    color: #6b7280;
}

.prct-code-section {
    background: white;
    border-radius: 1rem;
    padding: 2rem;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    margin-bottom: 2rem;
    border-left: 4px solid var(--xera-primary);
}

.prct-code-tabs {
    display: flex;
    margin-bottom: 1rem;
    border-bottom: 2px solid #e2e8f0;
}

.prct-code-tab {
    padding: 0.75rem 1.5rem;
    background: none;
    border: none;
    cursor: pointer;
    font-weight: 500;
    color: #6b7280;
    transition: all 0.3s ease;
    border-bottom: 2px solid transparent;
}

.prct-code-tab.active {
    color: var(--xera-primary);
    border-bottom-color: var(--xera-primary);
}

.prct-code-tab:hover {
    color: var(--xera-primary);
}

.prct-code-content {
    display: none;
}

.prct-code-content.active {
    display: block;
}

.prct-code-block {
    background: #1f2937;
    color: #e5e7eb;
    padding: 1.5rem;
    border-radius: 8px;
    overflow-x: auto;
    font-family: 'Courier New', monospace;
    font-size: 0.9rem;
    line-height: 1.5;
    box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.1);
}

.prct-rate-limit-card {
    background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);
    border: 1px solid #f59e0b;
    border-radius: 10px;
    padding: 1.5rem;
    margin: 1.5rem 0;
}

.prct-feature-list {
    list-style: none;
    padding-left: 0;
    margin: 1rem 0;
}

.prct-feature-list li {
    padding: 0.5rem 0;
    padding-left: 1.5rem;
    position: relative;
}

.prct-feature-list li::before {
    content: 'âœ“';
    color: var(--xera-primary);
    font-weight: bold;
    position: absolute;
    left: 0;
}

.prct-copy-button {
    position: absolute;
    top: 10px;
    right: 10px;
    background: #374151;
    color: #e5e7eb;
    border: none;
    border-radius: 4px;
    padding: 0.25rem 0.5rem;
    font-size: 0.75rem;
    cursor: pointer;
    transition: all 0.3s ease;
}

.prct-copy-button:hover {
    background: #4b5563;
}

.prct-copy-button.copied {
    background: var(--xera-primary);
    color: white;
}

@media (max-width: 768px) {
    .prct-api-hero-title {
        font-size: 2rem;
    }
    
    .prct-api-section, .prct-endpoint-section, .prct-code-section {
        padding: 1.5rem;
    }
    
    .prct-endpoint-header {
        flex-direction: column;
        align-items: flex-start;
    }
    
    .prct-method-badge {
        margin-bottom: 0.5rem;
    }
    
    .prct-code-tabs {
        flex-wrap: wrap;
    }
    
    .prct-api-stats {
        flex-direction: column;
    }
}
</style>
{% endblock %}

{% block content %}
<!-- PRCT API Hero Section -->
<section class="prct-api-hero">
    <div class="xera-container">
        <div class="prct-api-hero-content">
            <h1 class="prct-api-hero-title">
                <i class="fas fa-code me-3"></i>
                API Documentation
            </h1>
            <p class="prct-api-hero-subtitle">
                Complete REST API reference for the Post-Retraction Citation Tracker (PRCT).
                Access retracted papers, citation data, analytics, and democracy analysis programmatically.
            </p>
            <div class="prct-api-stats">
                <div class="prct-api-stat-item">
                    <div class="prct-api-stat-number">{{ api_version }}</div>
                    <div class="prct-api-stat-label">API Version</div>
                </div>
                <div class="prct-api-stat-item">
                    <div class="prct-api-stat-number">{{ endpoint_categories|length }}</div>
                    <div class="prct-api-stat-label">Categories</div>
                </div>
                <div class="prct-api-stat-item">
                    <div class="prct-api-stat-number">15+</div>
                    <div class="prct-api-stat-label">Endpoints</div>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- API Overview Section -->
<section class="py-5">
    <div class="xera-container">
        <div class="row">
            <div class="col-lg-8 mx-auto">
                <div class="prct-api-section">
                    <h2 class="fw-bold mb-3" style="color: var(--xera-primary);">
                        <i class="fas fa-info-circle me-2"></i>
                        API Overview
                    </h2>
                    <p class="lead mb-4">
                        The PRCT API provides programmatic access to our comprehensive database of retracted scientific papers, 
                        citation analysis, and research integrity tools. All endpoints return JSON responses and support various 
                        query parameters for filtering and customization.
                    </p>
                    
                    <h4 class="mb-3" style="color: var(--xera-primary);">Key Features</h4>
                    <ul class="prct-feature-list">
                        {% for feature in api_features %}
                        <li>{{ feature }}</li>
                        {% endfor %}
                    </ul>
                    
                    <div class="prct-rate-limit-card">
                        <h5 class="mb-3" style="color: #d97706;">
                            <i class="fas fa-tachometer-alt me-2"></i>
                            Rate Limits
                        </h5>
                        <ul class="mb-0">
                            <li><strong>General Endpoints:</strong> {{ rate_limits.general }}</li>
                            <li><strong>Export Endpoints:</strong> {{ rate_limits.export }}</li>
                            <li><strong>Analytics Endpoints:</strong> {{ rate_limits.analytics }}</li>
                        </ul>
                    </div>
                    
                    <div class="mt-4">
                        <p class="mb-2"><strong>Base URL:</strong> <code>{{ base_url }}</code></p>
                        <p class="mb-2"><strong>Authentication:</strong> Currently public (no API key required)</p>
                        <p class="mb-0"><strong>Response Format:</strong> JSON</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- API Endpoints Section -->
<section class="py-5">
    <div class="xera-container">
        <h2 class="prct-chart-title mb-4">
            <i class="fas fa-plug me-2"></i>API Endpoints
        </h2>
        
        {% for category in endpoint_categories %}
        <div class="prct-endpoint-section">
            <h3>
                <i class="fas fa-folder me-2"></i>
                {{ category.name }}
            </h3>
            <p class="text-muted mb-3">{{ category.description }}</p>
            
            {% for endpoint in category.endpoints %}
            <div class="prct-endpoint-card">
                <div class="prct-endpoint-header">
                    <span class="prct-method-badge prct-method-{{ endpoint.method|lower }}">{{ endpoint.method }}</span>
                    <h5 class="mb-0">{{ endpoint.name }}</h5>
                </div>
                
                <p class="text-muted mb-2">{{ endpoint.description }}</p>
                
                <div class="prct-endpoint-path">{{ endpoint.path }}</div>
                
                {% if endpoint.params %}
                <h6 class="mt-3 mb-2">Parameters</h6>
                <table class="prct-params-table">
                    <thead>
                        <tr>
                            <th>Parameter</th>
                            <th>Type</th>
                            <th>Required</th>
                            <th>Description</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for param in endpoint.params %}
                        <tr>
                            <td><code>{{ param.name }}</code></td>
                            <td><code>{{ param.type }}</code></td>
                            <td class="{% if param.required %}prct-param-required{% else %}prct-param-optional{% endif %}">
                                {% if param.required %}Required{% else %}Optional{% endif %}
                            </td>
                            <td>{{ param.description }}</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
                {% endif %}
                
                <div class="mt-3">
                    <strong>Example Request:</strong>
                    <div class="prct-endpoint-path">
                        GET {{ base_url }}{{ endpoint.path }}{% if endpoint.params and not endpoint.params.0.required %}?{% for param in endpoint.params %}{% if not param.required %}{{ param.name }}=example{% if not forloop.last %}&{% endif %}{% endif %}{% endfor %}{% endif %}
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
        {% endfor %}
    </div>
</section>

<!-- Code Examples Section -->
<section class="py-5">
    <div class="xera-container">
        <h2 class="prct-chart-title mb-4">
            <i class="fas fa-code me-2"></i>Code Examples
        </h2>
        
        <div class="prct-code-section">
            <div class="prct-code-tabs">
                <button class="prct-code-tab active" onclick="showCodeTab('javascript')">JavaScript</button>
                <button class="prct-code-tab" onclick="showCodeTab('python')">Python</button>
                <button class="prct-code-tab" onclick="showCodeTab('curl')">cURL</button>
                <button class="prct-code-tab" onclick="showCodeTab('r')">R</button>
            </div>
            
            <div id="javascript-code" class="prct-code-content active">
                <div style="position: relative;">
                    <pre class="prct-code-block">{{ code_examples.javascript }}</pre>
                    <button class="prct-copy-button" onclick="copyCode('javascript-code')">Copy</button>
                </div>
            </div>
            
            <div id="python-code" class="prct-code-content">
                <div style="position: relative;">
                    <pre class="prct-code-block">{{ code_examples.python }}</pre>
                    <button class="prct-copy-button" onclick="copyCode('python-code')">Copy</button>
                </div>
            </div>
            
            <div id="curl-code" class="prct-code-content">
                <div style="position: relative;">
                    <pre class="prct-code-block">{{ code_examples.curl }}</pre>
                    <button class="prct-copy-button" onclick="copyCode('curl-code')">Copy</button>
                </div>
            </div>
            
            <div id="r-code" class="prct-code-content">
                <div style="position: relative;">
                    <pre class="prct-code-block">{{ code_examples.r }}</pre>
                    <button class="prct-copy-button" onclick="copyCode('r-code')">Copy</button>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- Support Section -->
<section class="py-5">
    <div class="xera-container">
        <div class="row">
            <div class="col-lg-8 mx-auto text-center">
                <div class="prct-api-section">
                    <h3 class="mb-3" style="color: var(--xera-primary);">
                        <i class="fas fa-life-ring me-2"></i>Support & Contact
                    </h3>
                    <p class="mb-3">
                        Need help with the API? Have questions or feedback? We're here to help.
                    </p>
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <div class="xera-card h-100">
                                <div class="xera-card-body">
                                    <h6><i class="fas fa-book me-2" style="color: var(--xera-primary);"></i>Documentation</h6>
                                    <p class="small mb-0">Complete API reference and guides available on this page</p>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6 mb-3">
                            <div class="xera-card h-100">
                                <div class="xera-card-body">
                                    <h6><i class="fas fa-envelope me-2" style="color: var(--xera-primary);"></i>Email Support</h6>
                                    <p class="small mb-0">Contact: ahmad.pub@gmail.com</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="mt-3">
                        <small class="text-muted">
                            Last Updated: {{ last_updated }} | API Version: {{ api_version }}
                        </small>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

{% endblock %}

{% block extra_js %}
{{ block.super }}
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Add smooth scrolling for internal links
    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener('click', function (e) {
            e.preventDefault();
            const target = document.querySelector(this.getAttribute('href'));
            if (target) {
                target.scrollIntoView({
                    behavior: 'smooth'
                });
            }
        });
    });
    
    // Add animation to cards on scroll (consistent with PRCT theme)
    const observerOptions = {
        threshold: 0.1,
        rootMargin: '0px 0px -50px 0px'
    };
    
    const observer = new IntersectionObserver(function(entries) {
        entries.forEach(entry => {
            if (entry.isIntersecting) {
                entry.target.classList.add('prct-fade-in');
            }
        });
    }, observerOptions);
    
    // Observe all cards for animations (using PRCT theme classes)
    document.querySelectorAll('.prct-endpoint-section, .prct-endpoint-card, .prct-api-section, .prct-code-section').forEach(card => {
        observer.observe(card);
    });
});

// Code tab functionality
function showCodeTab(language) {
    // Hide all code contents
    document.querySelectorAll('.prct-code-content').forEach(content => {
        content.classList.remove('active');
    });
    
    // Remove active class from all tabs
    document.querySelectorAll('.prct-code-tab').forEach(tab => {
        tab.classList.remove('active');
    });
    
    // Show selected code content
    document.getElementById(language + '-code').classList.add('active');
    
    // Add active class to clicked tab
    event.target.classList.add('active');
}

// Copy code functionality
function copyCode(elementId) {
    const codeElement = document.querySelector('#' + elementId + ' .prct-code-block');
    const text = codeElement.textContent;
    
    navigator.clipboard.writeText(text).then(function() {
        const button = document.querySelector('#' + elementId + ' .prct-copy-button');
        const originalText = button.textContent;
        
        button.textContent = 'Copied!';
        button.classList.add('copied');
        
        setTimeout(function() {
            button.textContent = originalText;
            button.classList.remove('copied');
        }, 2000);
    }).catch(function() {
        // Fallback for older browsers
        const textArea = document.createElement('textarea');
        textArea.value = text;
        document.body.appendChild(textArea);
        textArea.select();
        document.execCommand('copy');
        document.body.removeChild(textArea);
        
        const button = document.querySelector('#' + elementId + ' .prct-copy-button');
        button.textContent = 'Copied!';
        button.classList.add('copied');
        
        setTimeout(function() {
            button.textContent = 'Copy';
            button.classList.remove('copied');
        }, 2000);
    });
}

// Syntax highlighting for code blocks (simple approach)
document.addEventListener('DOMContentLoaded', function() {
    document.querySelectorAll('.prct-code-block').forEach(block => {
        let html = block.innerHTML;
        
        // Simple syntax highlighting
        html = html.replace(/(async|function|const|let|var|import|from|class|def|if|else|for|while|try|except|catch)/g, '<span style="color: #f59e0b;">$1</span>');
        html = html.replace(/(GET|POST|PUT|DELETE)/g, '<span style="color: #10b981;">$1</span>');
        html = html.replace(/(".*?")/g, '<span style="color: #60a5fa;">$1</span>');
        html = html.replace(/(#.*$)/gm, '<span style="color: #6b7280;">$1</span>');
        
        block.innerHTML = html;
    });
});
</script>
{% endblock %}
